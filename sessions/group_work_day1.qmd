# Day 1 group work

::: callout-note
## Objective of this session

-   Conduct mediation analysis using the traditional approaches
-   Conduct mediation analysis using the 'mediation' R package
-   Understanding summary output with binary outcome variable
-   The limitations of the traditional approaches
:::

First, load the dataset and take a few minutes to explore the variables
in the dataset.

```{r setup}
library(here)
library(tidyverse)

load(here::here("data/frmghamdata.RData"))
```

## Variables

The dataset includes `r nrow(frmgham)` participants and
`r ncol(frmgham)`.

```{r}
str(frmgham)
```

## Research question

In this exercise, we will investigate the effect of obesity on the risk
of cardiovascular disease (CVD), and how much this relation is mediated
by high blood pressure. **Mediation analysis** could help us answer this
research question.

For the exercise on day 1, we will work with the following variables:

-   bmi = body mass index (BMI) (continuous variable in kg/m^2^)
-   sysbp = systolic blood pressure (continous)
-   cvd = (binary: 0=no, 1=yes).
-   cursmoke = smoking status (binary: 0 = no smoking, 1 = smoking)
-   educ = education (categorical variable)
-   sex = sex (0: male, 1: female)
-   age = age (continuous variable)

Note: in this example, the outcome of interest is the presence of CVD,
which is a binary variable. We will not think about time-to-event
outcomes for now. More on this will come later.

Before we start, let's think about the research question and draw a
directed acyclic graphs. You can either draw by hand or use daggity
(https://www.dagitty.net/).

[Address the following questions]{.underline}:

1.  Estimate the relationship between obesity and blood pressure (fit
    the mediator model).

Cleaning the data:

```{r}
frmgham_clean <- frmgham %>%
  select(
    id = randid, 
    w1 = sex,
    w2 = age,
    w3 = cursmoke,
    w4 = educ,
    a = bmi, # this is the exposure
    m = sysbp, # this is the mediator
    y = cvd # this is the outcome
  ) %>% 
  na.omit()

frmgham_clean <- frmgham_clean %>%
  mutate(a = case_when(a >= 30 ~ 1,
                       TRUE ~ 0))

```

2.  Estimate the effect of obesity on the prevalence of CVD, adjusting
    for SES, or other confounding factors based on your DAG.

3.  Estimate the effect of blood pressure on the prevalence of CVD,
    adjusting for obesity and other confounding factors based on your
    DAG.

4.  Now, calculate the direct effect and indirect effect using the
    product method and difference method, and compare results from the
    two approaches. Note: you do not need to estimate the confidence
    intervals.

Product method:

Difference method:

5.  Calculate the direct effect and indirect effect using the
    **mediation** package.

```{r, eval=FALSE}
library(CMAverse)

res_rb_confounders <- cmest(
  data = frmgham_clean,
  model = "rb",
  outcome = "y",
  exposure = "a",
  mediator = "m",
  basec = c("w1", "w2", "w3", "w4"),
  EMint = FALSE,
  mreg = list("linear"),
  yreg = "logistic",
  astar = 0,
  a = 1,
  mval = list(120),
  estimation = "paramfunc",
  inference = "delta"
)

summary(res_rb_confounders)
```

6.  Discuss the limitations of the traditional approach.
