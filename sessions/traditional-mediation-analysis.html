<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>traditional-mediation-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="traditional-mediation-analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="traditional-mediation-analysis_files/libs/quarto-html/quarto.js"></script>
<script src="traditional-mediation-analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="traditional-mediation-analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="traditional-mediation-analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="traditional-mediation-analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="traditional-mediation-analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="traditional-mediation-analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="traditional-mediation-analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="traditional-mediation-analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="traditional-mediation-analysis_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="traditional-mediation-analysis_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="traditional-mediation-analysis_files/libs/viz-1.8.2/viz.js"></script>
<link href="traditional-mediation-analysis_files/libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="traditional-mediation-analysis_files/libs/grViz-binding-1.0.11/grViz.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<ul>
<li>Teaching the concepts - Jie (75 min)</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Objective of this session
</div>
</div>
<div class="callout-body-container callout-body">
<p>To learn how to conduct mediation analyses using the traditional approaches, along with understanding the assumptions and limitations of the methods.</p>
</div>
</div>
<section id="what-is-mediation-analyses" class="level1">
<h1>What is Mediation analyses?</h1>
<p>The purpose of mediation analyses is to determine if the effect of an independent variable (X) on a dependent variable (Y) can be explained by a third variable-mediating variable (M). Thus, mediation analyses not only answer whether two variables are related, but also <strong>why and how</strong>. This can be visualized in the following figure:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/mediation_basic.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Basic Model</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/mediation_basic2.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Basic Mediation Model</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>the total effect –&gt;c, that is the total effect of the independent variable on the dependent variable</li>
<li>the direct effect –&gt; c’, that is the effect of the independent variable on the dependent variable that is not mediated by the mediator</li>
</ul>
<section id="traditional-approaches-for-mediation-analysis" class="level2">
<h2 class="anchored" data-anchor-id="traditional-approaches-for-mediation-analysis">Traditional approaches for mediation analysis</h2>
<p>The most widely used two traditional approaches to mediation analysis are <strong>the difference method</strong> and <strong>the product method</strong> (also known as Baron&amp;Kenny).</p>
<p><strong>the product method</strong> - indirect effect=a*b</p>
<p><strong>the difference method</strong> - indirect effect=c-c’</p>
<p>Here is the standard Equations for Mediator and Outcome (for the case of a continuous mediator and a continuous outcome)</p>
<ul>
<li>( E(M|A=a, C=c) = <span class="math inline">\(\beta_0\)</span> + <span class="math inline">\(\beta_1a\)</span> + <span class="math inline">\(\beta_2c\)</span> (1.1)</li>
<li>( E(Y|A=a, M=m, C=c) = <span class="math inline">\(\theta_0\)</span> + <span class="math inline">\(\theta_1a\)</span> + <span class="math inline">\(\theta_2m\)</span> + <span class="math inline">\(\theta4c\)</span> (1.2)</li>
<li>( E(Y|A=a, C=c) = <span class="math inline">\(\theta_0'\)</span> + <span class="math inline">\(\theta_1'a\)</span> + <span class="math inline">\(\theta4'c\)</span> (1.3)</li>
</ul>
</section>
<section id="empirical-example-in-nutritional-epidemiology" class="level2">
<h2 class="anchored" data-anchor-id="empirical-example-in-nutritional-epidemiology">Empirical example in nutritional epidemiology</h2>
<p>In this session, we will use an example to address a question about mediation in nutritional epidemiology using both methods.</p>
<p>It has been suggested that red meat is associated with higher blood glucose levels and a greater risk of Type 2 diabetes (T2D). However, we might be more interested in the mechanisms behind this relationship. Does red meat intake influence blood glucose levels directly or through other mechanisms (e.g., inflammation)?</p>
<blockquote class="blockquote">
<p>Does greater consumption of red meat lead to elevated levels of blood glucose by mediating specific inflammation biomarkers?</p>
</blockquote>
<p>Based on the literature, we hypothesize that higher red meat intake is associated with elevated inflammatory levels, which, in turn, increase blood glucose, as depicted in the figure below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating The causal diagram for a mediation model</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'DiagrammeR' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grViz</span>(<span class="st">"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">digraph {</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">  graph []</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape = plaintext]</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">    X [label = 'Red meat']</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">    M [label = 'Inflammation']</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">    Y [label = 'Blood glucose']</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">  edge [minlen = 1.5]</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">    X-&gt;Y [label = 'Path C*', xlabel = 'Path C']</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">    X-&gt;M [taillabel = 'Path A']</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">    M-&gt;Y [label = 'Path B']</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">  { rank = same; X; Y }</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">  { rank = min; M;}</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-fa446b817ff1e0711c18" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-fa446b817ff1e0711c18">{"x":{"diagram":"\ndigraph {\n  graph []\n  node [shape = plaintext]\n    X [label = \"Red meat\"]\n    M [label = \"Inflammation\"]\n    Y [label = \"Blood glucose\"]\n  edge [minlen = 1.5]\n    X->Y [label = \"Path C*\", xlabel = \"Path C\"]\n    X->M [taillabel = \"Path A\"]\n    M->Y [label = \"Path B\"]\n  { rank = same; X; Y }\n  { rank = min; M;}\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="example-dataset-a-brief-overview" class="level2">
<h2 class="anchored" data-anchor-id="example-dataset-a-brief-overview">Example Dataset: A Brief Overview</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We’ll explore the relationship between red meat intake and glucose levels in the National Health and Nutrition Examination Survey (NHANES) dataset, which has been modified for this course with simulated variables. NHANES is a program of studies designed to assess the health and nutritional status of adults and children in the United States. The survey includes extensive data collected through interviews and physical examinations.</p>
<p>Specifically, we want to understand how much a new inflammatory biomarker explains the relation between red meat intake and glucose levels.</p>
<p>The variables used in the dataset: -exposure of interest (x): red meat intake: (continuous variable, grams per day) -outcome (y): plasma fasting glucose (continuous variable, ) -mediator (m): a new inflammatory biomarker (continuous variable)</p>
<p>Four demographic variables will be included in the analyses: age, gender, education, and smoking. We assume that adjusting for these four confounders is sufficient to block the backdoor paths. Further discussion on confounding adjustment will be covered in the following session. For the convenience of analysis, I have transformed the mediator (m) and outcome variable (y) so that they follow a normal distribution.</p>
</div>
</div>
</section>
<section id="method-1-baron-kenny-the-product-method" class="level2">
<h2 class="anchored" data-anchor-id="method-1-baron-kenny-the-product-method">Method 1: Baron &amp; Kenny (the product method)</h2>
<p>According to Baron and Kenny (1986), the following criteria need to be satisfied for a variable to be considered a mediator: -(i) The exposure should be associated with the mediator; -(ii) in the model for the outcome that includes both the exposure and mediator, the mediator should be associated with the outcome; -(iii)in the model for the outcome that includes only the exposure, the exposure should be associated with the outcome; -(iv)when controlling for the mediator, the association between the exposure and outcome should be reduced, with the strongest demonstration of mediation occuring when the path from the exposure to the outcome, when controlling for the mediator is zero.</p>
<p>The following shows the basic steps for mediation analysis suggested by Baron &amp; Kenny.</p>
</section>
<section id="step1-estimate-the-relationship-between-x-on-m-path-a" class="level2">
<h2 class="anchored" data-anchor-id="step1-estimate-the-relationship-between-x-on-m-path-a">Step1-Estimate the relationship between X on M (path A)</h2>
<p>That is to check the relation between exposure (red meat) and the mediator (inflammatory biomarker), which corresponds to criteria (i). A mediation makes sense only if X affects M. If X and M have no relationship, M is just a third variable that may or may not be associated with Y.</p>
<p>As the mediator is a continuous variable, we can build a linear regression model, adjusting for confounders on the pathway between X and M.</p>
<p>$ (E(M|A=a, C=c)$ = <span class="math inline">\(\beta_0\)</span> + <span class="math inline">\(\beta_1a\)</span> + <span class="math inline">\(\beta_2c\)</span> (1.1)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#first load the dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"C:/Users/au644508/OneDrive - Aarhus universitet/Dokumenter/Mediation course/mediation-analysis-course/sessions/data/nhanes_dataset.RData"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>fita <span class="ot">&lt;-</span> <span class="fu">lm</span>(m <span class="sc">~</span> x <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span>  education_clean <span class="sc">+</span> smoke, <span class="at">data=</span>nhanes)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = m ~ x + age + gender + education_clean + smoke, 
    data = nhanes)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.2892 -0.6737  0.0135  0.6638  3.9884 

Coefficients:
                                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                       0.4661001  0.0400088  11.650   &lt;2e-16 ***
x                                 0.3979264  0.0022968 173.252   &lt;2e-16 ***
age                              -0.0003177  0.0005759  -0.552   0.5812    
genderFemale                     -0.0401686  0.0231644  -1.734   0.0829 .  
education_cleanCollege and above  0.0172594  0.0242118   0.713   0.4760    
smokeNo                           0.0403827  0.0225770   1.789   0.0737 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.002 on 8563 degrees of freedom
  (20755 observations deleted due to missingness)
Multiple R-squared:  0.7997,    Adjusted R-squared:  0.7995 
F-statistic:  6836 on 5 and 8563 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="step2--estimate-the-relationship-between-m-on-y-controlling-for-x-pathb" class="level2">
<h2 class="anchored" data-anchor-id="step2--estimate-the-relationship-between-m-on-y-controlling-for-x-pathb">Step2- Estimate the relationship between M on Y controlling for X (pathB)</h2>
<p>That is to build the model between inflammatory biomarker and glucose levels, controlling for red meat intake. This step corresponds to criteria (ii).</p>
<p><span class="math inline">\((E(Y|A=a, M=m, C=c)\)</span> = <span class="math inline">\(\theta_0\)</span> + <span class="math inline">\(\theta_1a\)</span> + <span class="math inline">\(\theta_2m\)</span> + <span class="math inline">\(\theta4c\)</span> (1.2)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fitb <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> m <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> education <span class="sc">+</span> smoke , <span class="at">data=</span>nhanes)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + m + age + gender + race + education + smoke, 
    data = nhanes)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.9002 -1.3430 -0.0029  1.3859  8.2529 

Coefficients:
                         Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)            107.855876   0.097733 1103.579   &lt;2e-16 ***
x                        0.810523   0.009772   82.941   &lt;2e-16 ***
m                        0.686302   0.021639   31.716   &lt;2e-16 ***
age                      1.500457   0.001177 1274.292   &lt;2e-16 ***
genderFemale            -0.022511   0.046414   -0.485    0.628    
raceNon-Hispanic Black   0.006464   0.048336    0.134    0.894    
raceOther                0.179376   0.119430    1.502    0.133    
raceDon't know           1.530786   1.159852    1.320    0.187    
education                0.028011   0.017605    1.591    0.112    
smokeNo                  0.024657   0.045155    0.546    0.585    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.007 on 8587 degrees of freedom
  (20727 observations deleted due to missingness)
Multiple R-squared:  0.9951,    Adjusted R-squared:  0.9951 
F-statistic: 1.931e+05 on 9 and 8587 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="step-3-estimate-the-relationship-between-x-on-y-path-c" class="level2">
<h2 class="anchored" data-anchor-id="step-3-estimate-the-relationship-between-x-on-y-path-c">Step 3-Estimate the relationship between X on Y-path C</h2>
<p>That is to build the model between red meat intake and glucose levels, without adjusting for inflammatory biomarker. The only difference between step 2 and step 3 is that mediator is not included in the model.</p>
<p><span class="math inline">\((E(Y|A=a, C=c)\)</span> = <span class="math inline">\(\theta_0'\)</span> + <span class="math inline">\(\theta_1'a\)</span> + <span class="math inline">\(\theta4'c\)</span> (1.3)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fitc <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> education <span class="sc">+</span> smoke, <span class="at">data=</span>nhanes)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + age + gender + race + education + smoke, 
    data = nhanes)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.5518 -1.4470  0.0064  1.4344  8.4541 

Coefficients:
                         Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)            108.148357   0.102832 1051.703   &lt;2e-16 ***
x                        1.083562   0.004887  221.716   &lt;2e-16 ***
age                      1.500304   0.001244 1205.591   &lt;2e-16 ***
genderFemale            -0.051189   0.049045   -1.044   0.2967    
raceNon-Hispanic Black  -0.006036   0.051084   -0.118   0.9059    
raceOther                0.223763   0.126216    1.773   0.0763 .  
raceDon't know           2.226142   1.225614    1.816   0.0694 .  
education                0.039439   0.018603    2.120   0.0340 *  
smokeNo                  0.051668   0.047715    1.083   0.2789    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.122 on 8588 degrees of freedom
  (20727 observations deleted due to missingness)
Multiple R-squared:  0.9945,    Adjusted R-squared:  0.9945 
F-statistic: 1.944e+05 on 8 and 8588 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Then we can estimate the direct effect and indirect effect:</p>
<ul>
<li><strong>direct effect</strong> = <span class="math inline">\(\theta_1\)</span><br>
</li>
<li><strong>indirect effect</strong> = <span class="math inline">\(\beta_1 \theta_2\)</span><br>
</li>
<li><strong>total effect</strong> = <span class="math inline">\(\theta_1'\)</span></li>
</ul>
</div>
</div>
<p>In our example, - the <em>direct effect</em> (<span class="math inline">\(\theta_1\)</span>) of red meat on glucose levels can be assessed by the coefficient of red meat in model b, which is 0.811.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>direct_ma <span class="ot">&lt;-</span> fitb<span class="sc">$</span>coefficients[<span class="dv">2</span>] </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>direct_ma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        x 
0.8105229 </code></pre>
</div>
</div>
<ul>
<li>the <em>indirect effect</em> can be assessed by calculating the product of <span class="math inline">\(\beta_1\)</span> <span class="math inline">\(\theta_2\)</span>. The intuition of the indirect effect is that the <strong>mediation</strong> depends on the extent to which the exposure changes the mediator (path A) and the extent to which the mediator changes the outcome (path B). In this example, the indirect effect between red meat and glucose levels through inflmmatory biomarker is 0.273.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>indirect_ma <span class="ot">&lt;-</span> fita<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>fitb<span class="sc">$</span>coefficients[<span class="dv">3</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>indirect_ma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        x 
0.2730978 </code></pre>
</div>
</div>
<ul>
<li>the <em>total effect</em> (<span class="math inline">\(\theta_1'\)</span>) of red meat on glucose levels can be assessed by the coefficient of red meat in model c, which is 1.084. You might have noticed the total effect also equals the sum of the direct effect and indirect effect.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>total_ma <span class="ot">&lt;-</span> fitc<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>total_ma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x 
1.083562 </code></pre>
</div>
</div>
</section>
<section id="method-2-difference-approach" class="level2">
<h2 class="anchored" data-anchor-id="method-2-difference-approach">Method 2-Difference approach</h2>
<p>The difference approach is more commonly used in epidemiologic domain. And the rational of this approach is to compare the effect of X on Y without and with adding M in the models.</p>
<p>If a mediation effect exists, the effect of X on Y will be attenuated when M is included in the regression, indicating the effect of X on Y goes through M. If the effect of X on Y completely disappears, M fully mediates between X and Y (full mediation). If the effect of X on Y still exists, but in a smaller magnitude, M partially mediates between X and Y (partial mediation).</p>
<p>Back to the example, the indirect effect will be the coefficient of red meat in model c (without adjusting for m) minus the coefficent of red meat in model b (adjusting for m), which equals to 0.273.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>indirect_mb <span class="ot">&lt;-</span> fitc<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">-</span>fitb<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>indirect_mb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        x 
0.2730394 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you recall the four criteria Originally suggested by Baron and Kenny, they proposed that ‘Path C must be significantly different from 0 to ensure there is a total effect between X and Y’, but this step might be controversial. Even if we don’t find a significant association between X and Y, we could proceed to the next step if we have a strong theoretical basis for their relationship.</p>
</div>
</div>
</section>
<section id="group-work--15-minutes" class="level2">
<h2 class="anchored" data-anchor-id="group-work--15-minutes">Group work- 15 minutes</h2>
<ul>
<li>Discuss with your group about the two tradiational approaches, did you get the same results?</li>
<li>Discuss the scenarios under which there might be no significant association between X and Y.</li>
</ul>
</section>
<section id="use-mediation-packages" class="level2">
<h2 class="anchored" data-anchor-id="use-mediation-packages">Use mediation packages</h2>
<p>Now we have estimated the direct and indirect effect using the product and the difference methods.You might have noticed what you got so far are only point estimates, but what if you want to see if this mediation effect is statistically significant (different from zero or not)?</p>
<p>To do so, there are two main approaches: the Sobel test (Sobel, 1982) and bootstrapping (Preacher &amp; Hayes, 2004).</p>
<p>Here I will demonstrate that we can use the mediate() function in ‘mediation’ package (Tingley et al.&nbsp;2019) to conduct mediation analysis. One of the very good options to conduct mediation analysis using the mediation package is we can get confidence interval by bootstrapping.</p>
<p>Let’s load up the R packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_cran</span>(<span class="st">"mediation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Skipping install of 'mediation' from a cran remote, the SHA1 (4.5.0) has not changed since last install.
  Use `force = TRUE` to force installation</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mediation) <span class="co">#Mediation package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'mediation' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'MASS' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'Matrix' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: mvtnorm</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'mvtnorm' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sandwich</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sandwich' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mediation: Causal Mediation Analysis
Version: 4.5.0</code></pre>
</div>
</div>
<p>mediate() takes two model objects as input (X → M and X + M → Y) and we need to specify which variable is an IV (treatment) and a mediator (mediator). For bootstrapping, set boot = TRUE and sims to at least 500.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit mediator model</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>lm_m  <span class="ot">&lt;-</span> <span class="fu">lm</span>(m <span class="sc">~</span> x <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span>  education <span class="sc">+</span> smoke, <span class="at">data =</span> nhanes)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit outcome model</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>lm_y <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> m <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span>  education <span class="sc">+</span> smoke, <span class="at">data =</span> nhanes)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run mediation analysis</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">mediate</span>(lm_m, lm_y, <span class="at">treat =</span> <span class="st">"x"</span>, <span class="at">mediator =</span> <span class="st">"m"</span>, <span class="at">boot =</span> <span class="cn">TRUE</span>, <span class="at">sims =</span> <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Running nonparametric bootstrap</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Causal Mediation Analysis 

Nonparametric Bootstrap Confidence Intervals with the Percentile Method

               Estimate 95% CI Lower 95% CI Upper p-value    
ACME              0.273        0.258         0.29  &lt;2e-16 ***
ADE               0.811        0.793         0.83  &lt;2e-16 ***
Total Effect      1.084        1.075         1.09  &lt;2e-16 ***
Prop. Mediated    0.252        0.238         0.27  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Sample Size Used: 8597 


Simulations: 500 </code></pre>
</div>
</div>
<ul>
<li><p><strong>ADE</strong> stands for average direct effects. It describes the direct effect of the x on the y when controlling for the mediator. Note this estimate is the same as the coefficient We got in the product and difference method (0.811). But be aware we are able to get <em>confidence interval</em> and <em>significance</em> levels for the indirect effect, not only its two individual parts by bootstrapping. This is something we need for reporting the mediation.</p></li>
<li><p><strong>ACME</strong> stands for average causal mediation effects. This is the indirect effect of the IV on the DV that goes through the mediator. Note that ACME estimated to be 0.273, which is the same to the traditional approached we just used.</p></li>
<li><p><strong>Total Effect</strong> stands for the total effect (direct + indirect) of the IV onto the DV. We can also get it by adding the ACME () and the ADE () to receive the total effect.</p></li>
<li><p><strong>Prop. Mediated</strong> describes the proportion of the effect of the IV on the DV that goes through the mediator. It’s calculated by dividing the ACME (0.273) by the total effect 1.084) and yields 0.252. The result suggests the mediator (inflammaotry biomarker) explains 25.2% proportion of the effect of red meat on glucose levels. We will talk more about proportion mediation in Session ?.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We can also plot the estimates</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="traditional-mediation-analysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For details of the mediate() package, please refer to (mediation_rpackage 2014).</p>
</section>
</section>
<section id="what-do-traditional-approach-succeed-and-fail" class="level1">
<h1>What do traditional approach succeed and fail?</h1>
<p>When fulfill the criterias, simple tools like regression can be used to estimate a causal mediation effect.</p>
<ul>
<li>no unmeasured confounding</li>
<li>no exposure-mediator interaction</li>
<li>linear relationship</li>
<li>rare binary outcome</li>
</ul>
</section>
<section id="reporting-the-mediation" class="level1">
<h1>Reporting the mediation</h1>
<ul>
<li>assumptions</li>
<li>introduction of dataset</li>
<li>difference and product method with code-along</li>
<li>linear outcome</li>
<li>binary outcome</li>
</ul>
<p>Go through the limitation of the traditional approach - Omar (15 min) - limitations of traditional approach - non-linearity - interactions - multi mediators</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>