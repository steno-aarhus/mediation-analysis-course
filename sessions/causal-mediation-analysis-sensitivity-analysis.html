<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>causal-mediation-analysis-sensitivity-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/quarto-html/quarto.js"></script>
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="causal-mediation-analysis-sensitivity-analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="causal-mediation-analysis-sensitivity-analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="causal-mediation-analysis-sensitivity-analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="causal-mediation-analysis-sensitivity-analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/viz-1.8.2/viz.js"></script>
<link href="causal-mediation-analysis-sensitivity-analysis_files/libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="causal-mediation-analysis-sensitivity-analysis_files/libs/grViz-binding-1.0.11/grViz.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="sensitivity-analysis-for-mediation-analysis" class="level1">
<h1>Sensitivity analysis for mediation analysis</h1>
<!-- ::: callout-note
##Add here the objective of the session and learning outcomes-->
<p>Unmeasured or uncontrolled confounding is a common problem in observational studies. This is a challenge to observational research even in the analysis of total effects</p>
<p>When we are interested in pathways and direct and indirect effects, the assumptions about confounding that are needed to identify these effects are even stronger than for total effects.</p>
<p>We might be worried that these assumptions are violated and that our estimates are biased</p>
<p><strong>Sensitivity analysis techniques can help assess HOW ROBUST results are to violations in the assumptions being made</strong> These techniques assess the extent to which an unmeasured variable (or variables) would have to affect both the exposure and the outcome in order for the observed associations between the two to be attributable solely to confounding rather than a causal effect of the exposure on the outcome It can also be useful in assessing a plausible range of values for the causal effect of the exposure on the outcome corresponding to a plausible range of assumptions concerning the relationship between the unmeasured confounder and the exposure and outcome</p>
<p>##Sensitivity analysis for unmeasured confounding for total effects Consider the following figure in which U represents an unmeasured confounder, <em>C</em> measured covariables, <em>A</em> the exposure and <em>Y</em> the outcome</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'DiagrammeR' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-7578c0b84091d2da3303" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7578c0b84091d2da3303">{"x":{"diagram":"\ndigraph {\n  graph []\n  node [shape = plaintext]\n    C [label = \"C\"]\n    A [label = \"A\"]\n    Y [label = \"Y\"]\n    U [label = \"U\"]\n  edge [minlen = 2]\n    A->Y\n    C->A\n    C->Y\n    U->A\n    U->Y\n{rank = same; C; A; Y; }\n{rank = max; U ; }\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The basic idea of sensitivity analysis is to specify parameters corresponding to the relationships between <em>U</em> and <em>Y</em> and between <em>U</em> and <em>A</em> and from these, along with the observed data, to obtain “corrected” effect estimates corresponding to what would have been obtained had control been made for <em>U</em> and not only <em>C</em>.</p>
<p>The results essentially compare: 1- what we obtain adjusting only for measured covariables <em>C</em> with 2- what we would have obtained had it been possible to adjust for measured covariables <em>C</em> and unmeasured covariable(s) <em>U</em>.</p>
<p>If it is thought that adjusting for <em>C</em> and <em>U</em> together would suffice to control for confounding, then we may also interpret the results as comparing the effect estimate that is obtained adjusting only for measured covariables <em>C</em> versus the true causal effect.</p>
<section id="continuous-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="continuous-outcomes">Continuous outcomes</h3>
<p>Suppose then we have obtained an estimate of the effect of the exposure A on the outcome Y conditional on measured covariables C using regression analysis.</p>
<p>We will define the bias factor B_add(<em>c</em>) on the additive scale as the difference between the expected differences in outcomes comparing A = a and A = a* conditional on covariables <em>C</em> = <em>c</em> and what we would have obtained had we been able to adjust for <em>U</em> as well.</p>
<p>If the exposure is binary, then we simply have <em>a</em> = 1 and <em>a</em> * = 0.</p>
<p>A simple approach to sensitivity analysis is possible if we assume that (A3.1) <em>U</em> is binary and (A3.2) that the effect of <em>U</em> (on the additive scale) is the same for those with exposure level <em>A</em> = <em>a</em> and exposure level <em>A</em> = <em>a</em> * (no <em>U</em> × <em>A</em> interaction).</p>
<p>If these assumptions hold, let γ be the effect of <em>U</em> on <em>Y</em> conditional on <em>A</em> and <em>C</em>, that is: <span class="math inline">\(γ = E(Y|a, c,U = 1)\)</span> − <span class="math inline">\(E(Y|a, c,U = 0)\)</span></p>
<p>Note that by assumption (A3.2), <span class="math inline">\(γ = E(Y|a, c,U = 1)\)</span> − <span class="math inline">\(E(Y|a, c,U = 0)\)</span> is the same for both levels of the exposure of interest. Note also that <em>γ</em> is the effect of <em>U</em> on <em>Y</em> already having adjusted for <em>C</em>; that is, in some sense the effect of <em>U</em> on <em>Y</em> not through <em>C</em></p>
<p>Now let <em>δ</em> denote the difference in the prevalence of the unmeasured confounder <em>U</em> for those with <em>A</em>=<em>a</em> versus those with <em>A</em> = <em>a</em> *, that is: <span class="math inline">\(δ = P(U = 1|a, c)\)</span> − <span class="math inline">\(P(U = 1|a*, c)\)</span></p>
<p>Under assumptions (A3.1) and (A3.2), the bias factor is simply given by the product of these two sensitivity analysis parameters: <span class="math inline">\(B_add(c) = γ δ\)</span></p>
<p>Thus to calculate the bias factor we only need to specify the effect of U on Y and the prevalence difference of U between the two exposure groups and then take the product of these two parameters.</p>
<p>Once we have calculated the bias term B_add(c), we can simply estimate our causal effect conditional on C and then subtract the bias factor to get the “corrected estimate”— that is, what we would have obtained if we had controlled for C and U.</p>
<p>Under these simplifying assumptions (A3.1) and (A3.2), we can also get adjusted confidence intervals by simply subtractingγ δ from both limits of the estimated confidence intervals</p>
<p>We may not believe any particular specification of the parameters γ and δ, but we could vary these parameters (based on expert knowledge or previous studies reporting estimates of the associations of the C and Y) over a range of plausible values to obtain what were thought to be a plausible range of corrected estimates.</p>
<p>Using this technique, we could also examine how substantial the confounding would have to be to explain away an effect (we could do this for the estimate and confidence interval).</p>
<!-- - binary outcome  




- natural direct and indirect effect

Note: if there is time, discuss multiple mediators

Coding part - Omar

#check the mediation package and the CMAverse package for sensitivity analysis
-->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>